### Kafka

**Kafka** — гибрид распределённой базы данных и брокера сообщений с возможностью горизонтального масштабирования. Kafka собирает у приложений данные, хранит их в своем распределённом хранилище, группируя по топикам, и отдаёт компонентам приложения по подписке. При этом сообщения хранятся на различных узлах-брокерах, что обеспечивает высокую доступность и отказоустойчивость.
Топик — это способ группировки потоков сообщений в хранилище по категориям.

Она позволяет разработчикам публиковать потоки записей с использованием тем Kafka и подписываться на них. Мы можем использовать docker-compose для управления потоками Kafka с использованием многоконтейнерных приложений Docker.

В этом руководстве мы научимся создавать тему Kafka с помощью Docker Compose. 

**Горизонтальное масштабирование** - техника, которая позволяет решить две задачи: выдержать большую нагрузку и повысить отказоустойчивость системы. Она используется как для нагруженных так и не нагруженных сайтов, которым важно оставаться работоспособными в случае отказа сервера.

### Настройка Kafka с помощью Docker Compose
version: '3'
services:
  zookeeper:
    image: wurstmeister/zookeeper
    container_name: zookeeper
    ports:
      - "2181:2181"
    networks:
      - kafka-net
  kafka:
    image: wurstmeister/kafka
    container_name: kafka
    ports:
      - "9092:9092"
    environment:
      KAFKA_ADVERTISED_LISTENERS: INSIDE://kafka:9092,OUTSIDE://localhost:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
      KAFKA_LISTENERS: INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:9093
      KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_CREATE_TOPICS: "baeldung:1:1"
    networks:
      - kafka-net
networks:
  kafka-net:
    driver: bridge

- Инструмент Docker Compose удобен для управления несколькими настройками служб. 
- Для кластера Kafka требуются Zookeeper и брокеры Kafka, что очень полезно в таком случае. 
- Чтобы настроить кластер Kafka, нам нужно запустить два сервиса: Zookeeper и Kafka Brokers.

- В  docker-comose.yml мы запускаем две разные службы. Служба zookeeper использует “wurstmeister / zookeeper” в качестве 
  базового образа. Кроме того, мы предоставили порт 2181 контейнера для хост-машины, который обеспечивает внешний доступ 
  к Zookeeper. Кроме того, мы запускаем службу Kafka с “wurstmeister / Kafka” в качестве базового образа. Чтобы разрешить 
  внешний доступ к серверу Kafka, мы предоставили порт 9092.

- Мы предоставили важные переменные ENV для службы Kafka. Эти переменные ENV настраивают параметры прослушивателя внутри 
  и за пределами сети Docker. Он использует протокол открытого ТЕКСТА, определяет адреса привязки для обоих 
  прослушивателей (0.0.0.0), указывает “INSIDE” в качестве имени прослушивателя между брокерами, предоставляет строку 
  подключения Zookeeper (используя имя контейнера “zookeeper” и порт 2181) и устанавливает раздел с именем “baeldung” с 
  коэффициентом репликации 1 и количеством разделов 1

  ###  Создание темы Kafka
До сих пор кластер Kafka запущен. Теперь давайте создадим тему Kafka:

$ docker-compose exec kafka kafka-topics.sh --create --topic baeldung_linux
  --partitions 1 --replication-factor 1 --bootstrap-server kafka:9092

В приведенной выше команде создается новый раздел с именем baeldung_linux с 1 разделом и 1 набором реплик с 
использованием брокера Kafka на порту 9092. Теперь, используя этот раздел, мы можем оптимизировать данные Kafka. Это 
позволит нам обмениваться сообщениями и событиями для различных приложений.


 ###  **Публикация и использование сообщений**
Теперь, когда тема Kafka создана, давайте опубликуем и используем некоторые сообщения. Сначала запустите пользователя, выполнив следующую команду:

$ docker-compose exec kafka kafka-console-consumer.sh --topic baeldung_linux
  --from-beginning --bootstrap-server kafka:9092
Копировать
Используя приведенную выше команду, мы сможем использовать все сообщения, отправленные в эту тему. Кроме того, мы использовали –from-beginning для использования всех сообщений, отправленных по теме с самого начала. Давайте также рассмотрим публикацию данных в этом разделе Kafka:

$ docker-compose exec kafka kafka-console-producer.sh --topic baeldung_linux
  --broker-list kafka:9092
Копировать
Используя приведенную выше команду, мы можем создавать и отправлять сообщения в тему baeldung_linux. Отправка сообщений в темы Kafka с помощью Docker проста и эффективна.

